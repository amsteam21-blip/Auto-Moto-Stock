var AMOTOS_Car_Search_Map=AMOTOS_Car_Search_Map||{};!function(a){"use strict";var e,t,r="",i="",s="",n="",l=".amotos-search-map-cars",c=[],o=!1;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(o=!0),AMOTOS_Car_Search_Map={init:function(){0!==a(l).length&&(void 0!==a(l).data("options")&&(window.amotos_search_map_vars=a(l).data("options")),"undefined"!=typeof amotos_search_map_vars&&(r=amotos_search_map_vars.ajax_url,i=amotos_search_map_vars.price_is_slider,s=amotos_search_map_vars.item_amount,n=amotos_search_map_vars.marker_image_size,"1"==amotos_search_map_vars.enable_filter_location&&(a(".amotos-car-country-ajax",l).select2(),a(".amotos-car-state-ajax",l).select2(),a(".amotos-car-city-ajax",l).select2(),a(".amotos-car-neighborhood-ajax",l).select2()),this.full_screen(),this.get_states_by_country(),a(".amotos-car-country-ajax",l).on("change",(function(){AMOTOS_Car_Search_Map.get_states_by_country()})),this.get_cities_by_state(),a(".amotos-car-state-ajax",l).on("change",(function(){AMOTOS_Car_Search_Map.get_cities_by_state()})),this.get_neighborhoods_by_city(),a(".amotos-car-city-ajax",l).on("change",(function(){AMOTOS_Car_Search_Map.get_neighborhoods_by_city()})),a(".btn-status-filter",l).on("click",(function(e){e.preventDefault();var t=a(this).data("value");a(this).parent().find("input").val(t),a(this).parent().find("button").removeClass("active"),a(this).addClass("active"),AMOTOS_Car_Search_Map.change_price_on_status_change(t)})),a('select[name="status"]',l).on("change",(function(e){e.preventDefault();var t=a(this).val();AMOTOS_Car_Search_Map.change_price_on_status_change(t)})),this.execute_url_search(),a(".amotos-sliderbar-filter.amotos-sliderbar-price",l).on("register.again",(function(){a(".amotos-sliderbar-filter.amotos-sliderbar-price",l).each((function(){var e=a(this);AMOTOS_Car_Search_Map.set_slider_filter(e)}))})),this.register_slider_filter(),this.set_slider_value(),this.car_map_paging(),this.search_map("map_only"),a(".amotos-sliderbar-filter.amotos-sliderbar-price",l).on("register.again",(function(){a(".amotos-sliderbar-filter.amotos-sliderbar-price",l).each((function(){var e=a(this);AMOTOS_Car_Search_Map.set_slider_filter(e)}))})),a(".amotos-search-status-tab .btn-status-filter",l).on("click",(function(){a(this).parent().find("input").val(a(this).data("value")),a(this).parent().find("button").removeClass("active"),a(this).addClass("active")})),a('select[name="type"],select[name="doors"], select[name="seats"],select[name="owners"] , select[name="label"],input[name="keyword"],input[name="address"],input[name="title"],input[name="car_identity"], select[name="min-price"], select[name="max-price"],select[name="min-mileage"], select[name="max-mileage"],select[name="min-power"], select[name="max-power"], select[name="min-volume"], select[name="max-volume"],select[name="city"], select[name="country"], select[name="state"], select[name="neighborhood"], .amotos-custom-search-field-select',l).on("change",(function(){AMOTOS_Car_Search_Map.search_map("map_and_content")})),a('input[name="other_stylings"]',l).on("change",(function(){AMOTOS_Car_Search_Map.search_map("map_and_content")}))))},get_states_by_country:function(){var e=a(".amotos-car-country-ajax",l);if(e.length){var t=e.val();a.ajax({type:"POST",url:r,data:{action:"amotos_get_states_by_country_ajax",country:t,type:1,is_slug:"1"},success:function(e){a(".amotos-car-state-ajax",l).html(e);var t=a(".amotos-car-state-ajax",l).attr("data-selected");void 0!==t&&a(".amotos-car-state-ajax",l).val(t)}})}},get_cities_by_state:function(){var e=a(".amotos-car-state-ajax",l);if(e.length){var t=e.val();a.ajax({type:"POST",url:r,data:{action:"amotos_get_cities_by_state_ajax",state:t,type:1,is_slug:"1"},success:function(e){a(".amotos-car-city-ajax",l).html(e);var t=a(".amotos-car-city-ajax",l).attr("data-selected");void 0!==t&&a(".amotos-car-city-ajax",l).val(t)}})}},get_neighborhoods_by_city:function(){var e=a(".amotos-car-city-ajax",l);if(e.length){var t=e.val();a.ajax({type:"POST",url:r,data:{action:"amotos_get_neighborhoods_by_city_ajax",city:t,type:1,is_slug:"1"},success:function(e){a(".amotos-car-neighborhood-ajax",l).html(e);var t=a(".amotos-car-neighborhood-ajax",l).attr("data-selected");void 0!==t&&a(".amotos-car-neighborhood-ajax",l).val(t)}})}},execute_url_search:function(){a(".amotos-advanced-search-btn",l).on("click",(function(e){e.preventDefault();var t=a(this).closest(".search-cars-form"),r=t.data("href"),i=[],s="?";-1!==r.indexOf("?")&&(s="&"),a(".search-field",t).each((function(){var e=a(this),t=e.attr("name"),r=e.val();r!=e.data("default-value")&&(i[t]=r)})),a(".amotos-sliderbar-filter",t).each((function(){var e=a(this),t=e.find(".min-input-request").attr("name"),r=e.find(".max-input-request").attr("name"),s=e.find(".min-input-request").val(),n=e.find(".max-input-request").val(),l=e.data("min-default"),c=e.data("max-default");s==l&&n==c||(i[t]=s,i[r]=n)}));var n="";if(a('[name="other_stylings"]',t).each((function(){var e=a(this),t=e.attr("value");e.is(":checked")&&(n+=t+";")})),""!==n&&(n=n.substring(0,n.length-1),i.other_stylings=n),i!==[])for(var l in i)i.hasOwnProperty(l)&&(s+=l+"="+encodeURIComponent(i[l])+"&");s=s.substring("0",s.length-1),window.location.href=r+s}))},set_slider_filter:function(a){var e,t,r=a,i=parseInt(r.attr("data-min-default")),s=parseInt(r.attr("data-max-default")),n=r.attr("data-min"),l=r.attr("data-max"),c=r.find(".sidebar-filter"),o="",m="";c.slider({min:i,max:s,range:!0,values:[n,l],slide:function(a,i){e=i.values[0],t=i.values[1],r.attr("data-min",e),r.attr("data-max",t),r.find("input.min-input-request").attr("value",e),r.find("input.max-input-request").attr("value",t),r.find("span").hasClass("not-format")?(o=e,m=t):(o=AMOTOS.number_format(e),m=AMOTOS.number_format(t)),r.hasClass("amotos-sliderbar-price")&&("before"===amotos_main_vars.currency_position?(o=amotos_main_vars.currency+o,m=amotos_main_vars.currency+m):(o+=amotos_main_vars.currency,m+=amotos_main_vars.currency)),r.find("span.min-value").html(o),r.find("span.max-value").html(m)},stop:function(a,e){AMOTOS_Car_Search_Map.search_map("map_and_content")}})},register_slider_filter:function(){a(".amotos-sliderbar-filter",l).each((function(){var e=a(this);AMOTOS_Car_Search_Map.set_slider_filter(e)}))},set_slider_value:function(){a(".amotos-sliderbar-filter",l).each((function(){var e=a(this),t=e.attr("data-min-default"),r=e.attr("data-max-default"),i=e.attr("data-min"),s=e.attr("data-max"),n=(i-t)/(r-t)*100+"%",l=(s-i)/(r-t)*100+"%",c=(s-t)/(r-t)*100+"%";e.find(".ui-slider-range.ui-corner-all.ui-widget-header").css({left:n,width:l}),e.find(".ui-slider-handle.ui-corner-all.ui-state-default").css("left",n),e.find(".ui-slider-handle.ui-corner-all.ui-state-default:last-child").css("left",c)}))},change_price_on_status_change:function(e){a.ajax({type:"POST",url:r,dataType:"json",data:{action:"amotos_ajax_change_price_on_status_change",status:e,price_is_slider:i},success:function(e){e.slide_html?(a(".amotos-sliderbar-price-wrap",l).html(e.slide_html),AMOTOS_Car_Search_Map.register_slider_filter(),AMOTOS_Car_Search_Map.set_slider_value()):(e.min_price_html&&a('select[name="min-price"]',l).html(e.min_price_html),e.max_price_html&&a('select[name="max-price"]',l).html(e.max_price_html)),AMOTOS_Car_Search_Map.search_map("map_and_content")}})},full_screen:function(){if(a(".amotos-search-map-cars").length>0){var e=a(window).outerHeight(),t=a("#wpadminbar").outerHeight();null==t&&(t=0);var r=a("header").outerHeight(),i=a("footer").outerHeight(),s=a("#wpadminbar").outerHeight();isNaN(s)&&(s=0);var n=e-t-r-i-s;a(".amotos-search-map-cars .amotos-map-search").css("height",n),a(".amotos-search-map-cars .amotos-map-search .amotos-map-result").css("height",n),a(".col-scroll-vertical").css({height:n,"overflow-y":"scroll","overflow-x":"hidden"});var l=a(".car-vertical-map-listing",".list-car-result-ajax"),c=a(".car-item",l);l.css("opacity",1),l.imagesLoaded((function(){AMOTOS.set_item_effect(c,"hide"),c=a(".car-item",l),AMOTOS.set_item_effect(c,"show")}))}},car_map_paging:function(){!0,a(".paging-navigation",".car-search-map-paging-wrap").each((function(){a("a",a(this)).off("click").on("click",(function(e){e.preventDefault();var t=a(this);AMOTOS_Car_Search_Map.search_map("map_and_content",t)}))}))},car_map_paging_control:function(){a(".paging-navigation",".car-search-map-paging-wrap").each((function(){var e=a(this);0===e.find("a.next").length?e.addClass("next-disable"):e.removeClass("next-disable")}))},search_map:function(i,d){var _,h,u,p,f,g,v,b,x,y,w,M,S,C,A,j,k,P,T,L,O,z,I,H=a(l),B=H.find(".amotos-map-result").attr("id");f=H.find('input[name="keyword"]').val(),g=H.find('input[name="title"]').val(),j=H.find('input[name="address"]').val(),h=H.find('select[name="city"]').val(),b=H.find('select[name="type"]').val(),null==(v=H.find('select[name="status"]').val())&&(v=H.find('input[name="status"]').val()),x=H.find('select[name="doors"]').val(),y=H.find('select[name="seats"]').val(),w=H.find('select[name="owners"]').val(),a(".amotos-sliderbar-price",H).length?(M=H.find(".amotos-sliderbar-filter.amotos-sliderbar-price").attr("data-min"),S=H.find(".amotos-sliderbar-filter.amotos-sliderbar-price").attr("data-max")):(M=H.find('select[name="min-price"]').val(),S=H.find('select[name="max-price"]').val()),a(".amotos-sliderbar-mileage",H).length?(C=H.find(".amotos-sliderbar-filter.amotos-sliderbar-mileage").attr("data-min"),A=H.find(".amotos-sliderbar-filter.amotos-sliderbar-mileage").attr("data-max")):(C=H.find('select[name="min-mileage"]').val(),A=H.find('select[name="max-mileage"]').val()),a(".amotos-sliderbar-power",H).length?(T=H.find(".amotos-sliderbar-filter.amotos-sliderbar-power").attr("data-min"),L=H.find(".amotos-sliderbar-filter.amotos-sliderbar-power").attr("data-max")):(T=H.find('select[name="min-power"]').val(),L=H.find('select[name="max-power"]').val()),a(".amotos-sliderbar-volume",H).length?(O=H.find(".amotos-sliderbar-filter.amotos-sliderbar-volume").attr("data-min"),z=H.find(".amotos-sliderbar-filter.amotos-sliderbar-volume").attr("data-max")):(O=H.find('select[name="min-volume"]').val(),z=H.find('select[name="max-volume"]').val()),u=H.find('select[name="state"]').val(),_=H.find('select[name="country"]').val(),p=H.find('select[name="neighborhood"]').val(),P=H.find('select[name="label"]').val(),I=H.find('input[name="car_identity"]').val(),k="",a('[name="other_stylings"]',H).each((function(){var e=a(this),t=e.attr("value");e.is(":checked")&&(k+=t+";")})),""!==k&&(k=k.substring(0,k.length-1));var E=a("#amotos_security_search_map").val(),q=a("#"+B),R=amotos_search_map_vars.googlemap_default_zoom,D=amotos_search_map_vars.not_found,N=amotos_search_map_vars.clusterIcon,Z=amotos_search_map_vars.google_map_style,G=amotos_search_map_vars.pin_cluster_enable,J={zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},scroll:{x:a(window).scrollLeft(),y:a(window).scrollTop()},zoom:parseInt(R),mapTypeId:google.maps.MapTypeId.ROADMAP,fullscreenControl:!0,gestureHandling:"cooperative",fullscreenControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER}};t=new InfoBox({disableAutoPan:!0,maxWidth:310,alignBottom:!0,pixelOffset:new google.maps.Size(-140,-55),zIndex:null,closeBoxMargin:"0 0 -16px -16px",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1});var Q=1;if(null!=d){var U=d.attr("href");Q=AMOTOS.get_page_number_from_href(U)}var W={action:"amotos_car_search_map_ajax",keyword:f,title:g,address:j,country:_,state:u,city:h,neighborhood:p,type:b,status:v,doors:x,seats:y,owners:w,min_price:M,max_price:S,min_mileage:C,max_mileage:A,label:P,min_power:T,max_power:L,min_volume:O,max_volume:z,car_identity:I,stylings:k,search_type:i,paged:Q,item_amount:s,marker_image_size:n,amotos_security_search_map:E};a(".amotos-custom-search-field",H).each((function(){W[a(this).attr("name")]=a(this).val()})),a.ajax({dataType:"json",url:r,data:W,beforeSend:function(){q.parents("div.amotos-search-map-cars").find("#amotos-map-loading").fadeIn()},success:function(r){if("map_and_content"==i){var s=a(".car-vertical-map-listing"),n=a(".list-car-result-ajax");if(!1===r.success){if(n.find(".title-result h2 .number-result").hide(),n.find(".title-result h2 .text-no-result").show(),n.find(".title-result h2 .text-result").hide(),n.find(".car-vertical-map-listing").hide(),n.find(".car-search-map-paging-wrap").hide(),window.matchMedia("(max-width: 991px)").matches){var l=a(".car-result-wrap").offset().top-50;a("html,body").animate({scrollTop:+l+"px"},500)}}else{var d=a(".car-item",r.car_html),_=a(".car-search-map-paging-wrap",r.car_html);if(s.css("opacity",0),s.html(d),AMOTOS.set_item_effect(d,"hide"),window.matchMedia("(max-width: 991px)").matches){var h=a(".car-result-wrap").offset().top-50;a("html,body").animate({scrollTop:+h+"px"},500)}s.css("opacity",1),s.imagesLoaded((function(){d=a(".car-item",s),AMOTOS.set_item_effect(d,"show"),s.closest("div.list-car-result-ajax").find(".car-search-map-paging-wrap").html(_.html()),AMOTOS_Car_Search_Map.car_map_paging(),AMOTOS_Car_Search_Map.car_map_paging_control(),AMOTOS.favorite(),AMOTOS.tooltip(),AMOTOS_Compare.register_event_compare()})),"0"!=d.length&&(n.find(".title-result h2 .number-result").html(r.total_post),n.find(".title-result h2 .number-result").show(),n.find(".title-result h2 .text-no-result").hide(),n.find(".title-result h2 .text-result").show(),n.find(".car-vertical-map-listing").show(),n.find(".car-search-map-paging-wrap").show())}}if(!0,e=new google.maps.Map(document.getElementById(B),J),google.maps.event.trigger(e,"resize"),!0===r.success&&r.cars)var u=r.cars.length;if(1==u)var p=google.maps.event.addListener(e,"bounds_changed",(function(a){this.setZoom(parseInt(R)),google.maps.event.removeListener(p)}));if(""!==Z){var f=JSON.parse(Z);e.setOptions({styles:f})}var g,v,b=new google.maps.LatLng("","");if(e.setCenter(b),e.setZoom(parseInt(R)),google.maps.event.addListener(e,"tilesloaded",(function(){a("#amotos-map-loading").fadeOut()})),!0===r.success){for(var x=0;x<c.length;x++)c[x].setMap(null);c=[],g=r.cars,v=e,a.each(g,(function(a,e){for(var r=new google.maps.LatLng(e.lat,e.lng),i={url:e.marker_icon,size:new google.maps.Size(44,60),scaledSize:new google.maps.Size(44,60),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(7,27)},s=r,n=0;n<c.length;n++){var l=c[n].getPosition();if(r.equals(l)){var o=r.lat()+(Math.random()-.5)/1500,m=r.lng()+(Math.random()-.5)/1500;s=new google.maps.LatLng(o,m)}}var d=new google.maps.Marker({position:s,map:v,icon:i,draggable:!1,animation:google.maps.Animation.DROP}),_=veh.data?veh.data.post_title:veh.title,h="";""!=veh.image_url&&void 0!==veh.image_url||(h='style="display: none;"');var u=document.createElement("div");u.className="marker-content clearfix",u.innerHTML='<div class="marker-content-inner clearfix"><div class = "item-thumb" '+h+'><a href="'+veh.url+'"><img src="'+veh.image_url+'" alt="'+_+'"></a></div><div class="item-body"><a href="'+veh.url+'" class="title-marker">'+_+'</a><div class="price-marker">'+veh.price+'</div><div class="address-marker"><i class="fa fa-map-marker"></i>'+veh.address+"</div></div></div>",google.maps.event.addListener(d,"click",function(a,e){return function(){var e=100/Math.pow(2,v.getZoom())||0,r=v.getProjection(),i=a.getPosition(),s=r.fromLatLngToPoint(i),n=new google.maps.Point(s.x,s.y-e),l=r.fromPointToLatLng(n);v.setCenter(l),setTimeout((function(){t.setContent(u),t.open(v,a)}),300)}}(d)),c.push(d)})),e.fitBounds(c.reduce((function(a,e){return a.extend(e.getPosition())}),new google.maps.LatLngBounds)),google.maps.event.trigger(e,"resize"),"1"==G&&new MarkerClusterer(e,c,{gridSize:60,maxZoom:18,styles:[{url:N,width:48,height:48,textColor:"#fff"}]}),o||m()}else q.empty().html('<div class="map-notfound">'+D+"</div>");q.closest("div.amotos-search-map-cars").find("#amotos-map-loading").fadeOut("slow")},error:function(){q.closest("div.amotos-search-map-cars").find("#amotos-map-loading").fadeOut("slow"),!0}})}};var m=function(){return a(".car-item",l).each((function(r){a(this).on("mouseenter",(function(){e&&google.maps.event.trigger(c[r],"click")})),a(this).on("mouseleave",(function(){t.open(null,null)}))})),!1};a(document).ready((function(){a("body").hasClass("elementor-editor-active")||AMOTOS_Car_Search_Map.init()})),a(window).resize((function(){AMOTOS_Car_Search_Map.full_screen()})),a(window).on("orientationchange",(function(){AMOTOS_Car_Search_Map.full_screen()})),a("body").keydown((function(e){return 35==e.which||34==e.which?(a(".col-scroll-vertical").animate({scrollTop:a(".col-scroll-vertical-inner").height()},"slow"),!1):36==e.which||33==e.which?(a(".col-scroll-vertical").animate({scrollTop:0},"slow"),!1):void 0}))}(jQuery);
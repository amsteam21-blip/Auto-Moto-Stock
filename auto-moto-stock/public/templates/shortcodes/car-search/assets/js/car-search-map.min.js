var AMOTOS_Car_Map_Search=AMOTOS_Car_Map_Search||{};!function(e){"use strict";var a,t,s="",r="",i=".amotos-search-cars-map",n=[],l=!1;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(l=!0),AMOTOS_Car_Map_Search={init:function(){0!==e(i).length&&(void 0!==e(i).data("options")&&(window.amotos_search_vars=e(i).data("options")),"undefined"!=typeof amotos_search_vars&&(s=amotos_search_vars.ajax_url,r=amotos_search_vars.price_is_slider,"1"==amotos_search_vars.enable_filter_location&&(e(".amotos-car-country-ajax",i).select2(),e(".amotos-car-state-ajax",i).select2(),e(".amotos-car-city-ajax",i).select2(),e(".amotos-car-neighborhood-ajax",i).select2()),this.full_screen(),this.get_states_by_country(),e(".amotos-car-country-ajax",i).on("change",(function(){AMOTOS_Car_Map_Search.get_states_by_country()})),this.get_cities_by_state(),e(".amotos-car-state-ajax",i).on("change",(function(){AMOTOS_Car_Map_Search.get_cities_by_state()})),this.get_neighborhoods_by_city(),e(".amotos-car-city-ajax",i).on("change",(function(){AMOTOS_Car_Map_Search.get_neighborhoods_by_city()})),e(".btn-status-filter",i).on("click",(function(a){a.preventDefault();var t=e(this).data("value");e(this).parent().find("input").val(t),e(this).parent().find("button").removeClass("active"),e(this).addClass("active"),AMOTOS_Car_Map_Search.change_price_on_status_change(t)})),e('select[name="status"]',i).on("change",(function(a){a.preventDefault();var t=e(this).val();AMOTOS_Car_Map_Search.change_price_on_status_change(t)})),this.execute_url_search(),e(".amotos-sliderbar-filter.amotos-sliderbar-price",i).on("register.again",(function(){e(".amotos-sliderbar-filter.amotos-sliderbar-price",i).each((function(){var a=e(this);AMOTOS_Car_Map_Search.set_slider_filter(a)}))})),this.register_slider_filter(),this.set_slider_value(),e(".amotos-sliderbar-filter.amotos-sliderbar-price",i).on("register.again",(function(){e(".amotos-sliderbar-filter.amotos-sliderbar-price",i).each((function(){var a=e(this);AMOTOS_Car_Map_Search.set_slider_filter(a)}))})),e(".amotos-search-status-tab .btn-status-filter",i).on("click",(function(){e(this).parent().find("input").val(e(this).data("value")),e(this).parent().find("button").removeClass("active"),e(this).addClass("active")})),e('select[name="type"],select[name="doors"], select[name="seats"],select[name="owners"] , select[name="label"],input[name="keyword"],input[name="address"],input[name="title"],input[name="car_identity"], select[name="min-price"], select[name="max-price"],select[name="min-mileage"], select[name="max-mileage"], select[name="min-power"], select[name="max-power"], select[name="min-volume"], select[name="max-volume"], select[name="city"], select[name="country"], select[name="state"], select[name="neighborhood"], .amotos-custom-search-field-select',i).on("change",(function(){AMOTOS_Car_Map_Search.search_on_change()})),e('input[name="other_stylings"]',i).on("change",(function(){AMOTOS_Car_Map_Search.search_on_change()})),AMOTOS_Car_Map_Search.search_cars("map_only")))},get_states_by_country:function(){var a=e(".amotos-car-country-ajax",i);if(a.length){var t=a.val();e.ajax({type:"POST",url:s,data:{action:"amotos_get_states_by_country_ajax",country:t,type:1,is_slug:"1"},success:function(a){e(".amotos-car-state-ajax",i).html(a);var t=e(".amotos-car-state-ajax",i).attr("data-selected");void 0!==t&&e(".amotos-car-state-ajax",i).val(t)}})}},get_cities_by_state:function(){var a=e(".amotos-car-state-ajax",i);if(a.length){var t=a.val();e.ajax({type:"POST",url:s,data:{action:"amotos_get_cities_by_state_ajax",state:t,type:1},success:function(a){e(".amotos-car-city-ajax",i).html(a);var t=e(".amotos-car-city-ajax",i).attr("data-selected");void 0!==t&&e(".amotos-car-city-ajax",i).val(t)}})}},get_neighborhoods_by_city:function(){var a=e(".amotos-car-city-ajax",i);if(a.length){var t=a.val();e.ajax({type:"POST",url:s,data:{action:"amotos_get_neighborhoods_by_city_ajax",city:t,type:1,is_slug:"1"},success:function(a){e(".amotos-car-neighborhood-ajax",i).html(a);var t=e(".amotos-car-neighborhood-ajax",i).attr("data-selected");void 0!==t&&e(".amotos-car-neighborhood-ajax",i).val(t)}})}},execute_url_search:function(){e(".amotos-advanced-search-btn",i).on("click",(function(a){a.preventDefault();var t=e(this).closest(".search-cars-form"),s=t.data("href"),r=[],i="?";-1!==s.indexOf("?")&&(i="&"),e(".search-field",t).each((function(){var a=e(this),t=a.attr("name"),s=a.val();s!=a.data("default-value")&&(r[t]=s)})),e(".amotos-sliderbar-filter",t).each((function(){var a=e(this),t=a.find(".min-input-request").attr("name"),s=a.find(".max-input-request").attr("name"),i=a.find(".min-input-request").val(),n=a.find(".max-input-request").val(),l=a.data("min-default"),c=a.data("max-default");i==l&&n==c||(r[t]=i,r[s]=n)}));var n="";if(e('[name="other_stylings"]',t).each((function(){var a=e(this),t=a.attr("value");a.is(":checked")&&(n+=t+";")})),""!==n&&(n=n.substring(0,n.length-1),r.other_stylings=n),r!==[])for(var l in r)r.hasOwnProperty(l)&&(i+=l+"="+encodeURIComponent(r[l])+"&");i=i.substring("0",i.length-1),window.location.href=s+i}))},set_slider_filter:function(e){var a,t,s=e,r=parseInt(s.attr("data-min-default")),i=parseInt(s.attr("data-max-default")),n=s.attr("data-min"),l=s.attr("data-max"),c=s.find(".sidebar-filter"),o="",m="";c.slider({min:r,max:i,range:!0,values:[n,l],slide:function(e,r){a=r.values[0],t=r.values[1],s.attr("data-min",a),s.attr("data-max",t),s.find("input.min-input-request").attr("value",a),s.find("input.max-input-request").attr("value",t),s.find("span").hasClass("not-format")?(o=a,m=t):(o=AMOTOS.number_format(a),m=AMOTOS.number_format(t)),s.hasClass("amotos-sliderbar-price")&&("before"===amotos_main_vars.currency_position?(o=amotos_main_vars.currency+o,m=amotos_main_vars.currency+m):(o+=amotos_main_vars.currency,m+=amotos_main_vars.currency)),s.find("span.min-value").html(o),s.find("span.max-value").html(m)},stop:function(e,a){AMOTOS_Car_Map_Search.search_on_change()}})},register_slider_filter:function(){e(".amotos-sliderbar-filter",i).each((function(){var a=e(this);AMOTOS_Car_Map_Search.set_slider_filter(a)}))},set_slider_value:function(){e(".amotos-sliderbar-filter",i).each((function(){var a=e(this),t=a.attr("data-min-default"),s=a.attr("data-max-default"),r=a.attr("data-min"),i=a.attr("data-max"),n=(r-t)/(s-t)*100+"%",l=(i-r)/(s-t)*100+"%",c=(i-t)/(s-t)*100+"%";a.find(".ui-slider-range.ui-corner-all.ui-widget-header").css({left:n,width:l}),a.find(".ui-slider-handle.ui-corner-all.ui-state-default").css("left",n),a.find(".ui-slider-handle.ui-corner-all.ui-state-default:last-child").css("left",c)}))},change_price_on_status_change:function(a){e.ajax({type:"POST",url:s,dataType:"json",data:{action:"amotos_ajax_change_price_on_status_change",status:a,price_is_slider:r},success:function(a){a.slide_html?(e(".amotos-sliderbar-price-wrap",i).html(a.slide_html),AMOTOS_Car_Map_Search.register_slider_filter(),AMOTOS_Car_Map_Search.set_slider_value()):(a.min_price_html&&e('select[name="min-price"]',i).html(a.min_price_html),a.max_price_html&&e('select[name="max-price"]',i).html(a.max_price_html)),AMOTOS_Car_Map_Search.search_on_change()}})},full_screen:function(){if(e(".amotos-search-cars-map.style-vertical").length>0){var a=e(window).outerHeight();e("#wpadminbar").length>0&&(a-=e("#wpadminbar").outerHeight()),e("header").length>0&&(a-=e("header").outerHeight()),e("footer").length>0&&(a-=e("footer").outerHeight()),e(".amotos-search-cars-map.style-vertical .amotos-map-search").css("height",a),e(".amotos-search-cars-map.style-vertical .amotos-map-search .amotos-map-result").css("height",a),e(".col-scroll-vertical").css("height",a);var t=e(".owl-carousel",".list-car-result-ajax"),s=e(".car-item",t);t.trigger("destroy.owl.carousel"),t.css("opacity",1),t.imagesLoaded((function(){AMOTOS.set_item_effect(s,"hide"),AMOTOS_Carousel.owlCarousel(),s=e(".car-item",t),AMOTOS.set_item_effect(s,"show")}))}},search_on_change:function(){var a="map_only";e(".list-car-result-ajax",i).length>0&&(a="map_and_content"),AMOTOS_Car_Map_Search.search_cars(a)},search_cars:function(r){var o,m,d,_,u,h,f,p,g,v,y,b,x,M,S,w,C,A,j,P,k,L,O,T=e(i);u=T.find('input[name="keyword"]').val(),h=T.find('input[name="title"]').val(),w=T.find('input[name="address"]').val(),m=T.find('select[name="city"]').val(),p=T.find('select[name="type"]').val(),null==(f=T.find('select[name="status"]').val())&&(f=T.find('input[name="status"]').val()),g=T.find('select[name="doors"]').val(),v=T.find('select[name="seats"]').val(),y=T.find('select[name="owners"]').val(),e(".amotos-sliderbar-price",T).length?(b=T.find(".amotos-sliderbar-filter.amotos-sliderbar-price").attr("data-min"),x=T.find(".amotos-sliderbar-filter.amotos-sliderbar-price").attr("data-max")):(b=T.find('select[name="min-price"]').val(),x=T.find('select[name="max-price"]').val()),e(".amotos-sliderbar-mileage",T).length?(M=T.find(".amotos-sliderbar-filter.amotos-sliderbar-mileage").attr("data-min"),S=T.find(".amotos-sliderbar-filter.amotos-sliderbar-mileage").attr("data-max")):(M=T.find('select[name="min-mileage"]').val(),S=T.find('select[name="max-mileage"]').val()),e(".amotos-sliderbar-power",T).length?(j=T.find(".amotos-sliderbar-filter.amotos-sliderbar-power").attr("data-min"),P=T.find(".amotos-sliderbar-filter.amotos-sliderbar-power").attr("data-max")):(j=T.find('select[name="min-power"]').val(),P=T.find('select[name="max-power"]').val()),e(".amotos-sliderbar-volume",T).length?(k=T.find(".amotos-sliderbar-filter.amotos-sliderbar-volume").attr("data-min"),L=T.find(".amotos-sliderbar-filter.amotos-sliderbar-volume").attr("data-max")):(k=T.find('select[name="min-volume"]').val(),L=T.find('select[name="max-volume"]').val()),d=T.find('select[name="state"]').val(),o=T.find('select[name="country"]').val(),_=T.find('select[name="neighborhood"]').val(),A=T.find('select[name="label"]').val(),O=T.find('input[name="car_identity"]').val(),C="",e('[name="other_stylings"]',T).each((function(){var a=e(this),t=a.attr("value");a.is(":checked")&&(C+=t+";")})),""!==C&&(C=C.substring(0,C.length-1));var I=e("#amotos_security_search_map").val(),z=e(T).find(".amotos-map-result").attr("id"),B=e("#"+z),H=amotos_search_vars.googlemap_default_zoom,E=amotos_search_vars.not_found,q=amotos_search_vars.clusterIcon,R=amotos_search_vars.google_map_style,D=amotos_search_vars.pin_cluster_enable,N={zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},scroll:{x:e(window).scrollLeft(),y:e(window).scrollTop()},zoom:parseInt(H),mapTypeId:google.maps.MapTypeId.ROADMAP,gestureHandling:"cooperative",fullscreenControl:!0,fullscreenControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER}};t=new InfoBox({disableAutoPan:!0,maxWidth:310,alignBottom:!0,pixelOffset:new google.maps.Size(-140,-55),zIndex:null,closeBoxMargin:"0 0 -16px -16px",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1});var Z={action:"amotos_car_search_ajax",keyword:u,title:h,address:w,country:o,state:d,city:m,neighborhood:_,type:p,status:f,doors:g,seats:v,owners:y,min_price:b,max_price:x,min_mileage:M,max_mileage:S,label:A,min_power:j,max_power:P,min_volume:k,max_volume:L,car_identity:O,stylings:C,search_type:r,amotos_security_search_map:I};e(".amotos-custom-search-field",T).each((function(){Z[e(this).attr("name")]=e(this).val()})),e.ajax({dataType:"json",url:s,data:Z,beforeSend:function(){B.parents("div.amotos-search-cars-map").find("#amotos-map-loading").fadeIn()},success:function(s){if("map_and_content"==r){var i=e(".owl-carousel",".list-car-result-ajax"),o=e(".list-car-result-ajax");if(i.empty(),!1===s.success)o.find(".title-result h2 .number-result").hide(),o.find(".title-result h2 .text-no-result").show(),o.find(".title-result h2 .text-result").hide();else{var m=e(".car-item",s.car_html);i.css("opacity",0),i.trigger("destroy.owl.carousel"),i.html(m),i.css("opacity",1),i.imagesLoaded((function(){AMOTOS.set_item_effect(m,"hide"),AMOTOS_Carousel.owlCarousel(),m=e(".car-item",i),AMOTOS.set_item_effect(m,"show")})),"0"!=m.length&&(o.find(".title-result h2 .number-result").html(m.length),o.find(".title-result h2 .number-result").show(),o.find(".title-result h2 .text-no-result").hide(),o.find(".title-result h2 .text-result").show())}AMOTOS.favorite(),AMOTOS.tooltip(),AMOTOS_Compare.register_event_compare()}if(a=new google.maps.Map(document.getElementById(z),N),google.maps.event.trigger(a,"resize"),!0===s.success&&s.cars)var d=s.cars.length;if(1==d)var _=google.maps.event.addListener(a,"bounds_changed",(function(e){this.setZoom(parseInt(H)),google.maps.event.removeListener(_)}));if(""!==R){var u=JSON.parse(R);a.setOptions({styles:u})}var h,f,p=new google.maps.LatLng("","");if(a.setCenter(p),a.setZoom(parseInt(H)),google.maps.event.addListener(a,"tilesloaded",(function(){e("#amotos-map-loading").fadeOut()})),!0===s.success){for(var g=0;g<n.length;g++)n[g].setMap(null);n=[],h=s.cars,f=a,e.each(h,(function(e,a){for(var s=new google.maps.LatLng(a.lat,a.lng),r={url:a.marker_icon,size:new google.maps.Size(44,60),scaledSize:new google.maps.Size(44,60),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(7,27)},i=s,l=0;l<n.length;l++){var c=n[l].getPosition();if(s.equals(c)){var o=s.lat()+(Math.random()-.5)/1500,m=s.lng()+(Math.random()-.5)/1500;i=new google.maps.LatLng(o,m)}}var d=new google.maps.Marker({position:i,map:f,icon:r,draggable:!1,animation:google.maps.Animation.DROP}),_=veh.data?veh.data.post_title:veh.title,u="";""!=veh.image_url&&void 0!==veh.image_url||(u='style="display: none;"');var h=document.createElement("div");h.className="marker-content clearfix",h.innerHTML='<div class="marker-content-inner clearfix"><div class = "item-thumb" '+u+'><a href="'+veh.url+'"><img src="'+veh.image_url+'" alt="'+_+'" style="width: 100px;"></a></div><div class="item-body"><a href="'+veh.url+'" class="title-marker">'+_+'</a><div class="price-marker">'+veh.price+'</div><div class="address-marker"><i class="fa fa-map-marker"></i>'+veh.address+"</div></div></div>",google.maps.event.addListener(d,"click",function(e,a){return function(){var a=100/Math.pow(2,f.getZoom())||0,s=f.getProjection(),r=e.getPosition(),i=s.fromLatLngToPoint(r),n=new google.maps.Point(i.x,i.y-a),l=s.fromPointToLatLng(n);f.setCenter(l),setTimeout((function(){t.setContent(h),t.open(f,e)}),300)}}(d)),n.push(d)})),a.fitBounds(n.reduce((function(e,a){return e.extend(a.getPosition())}),new google.maps.LatLngBounds)),google.maps.event.trigger(a,"resize"),"1"==D&&new MarkerClusterer(a,n,{gridSize:60,maxZoom:18,styles:[{url:q,width:48,height:48,textColor:"#fff"}]}),l||c()}else B.empty().html('<div class="map-notfound">'+E+"</div>");B.closest("div.amotos-search-cars-map").find("#amotos-map-loading").fadeOut("slow")},error:function(){B.closest("div.amotos-search-cars-map").find("#amotos-map-loading").fadeOut("slow")}})}};var c=function(){return e(".car-item",i).each((function(s){e(this).on("mouseenter",(function(){a&&google.maps.event.trigger(n[s],"click")})),e(this).on("mouseleave",(function(){t.open(null,null)}))})),!1};e(document).ready((function(){e("body").hasClass("elementor-editor-active")||AMOTOS_Car_Map_Search.init()})),e(window).resize((function(){AMOTOS_Car_Map_Search.full_screen()})),e(window).on("orientationchange",(function(){AMOTOS_Car_Map_Search.full_screen()}))}(jQuery);
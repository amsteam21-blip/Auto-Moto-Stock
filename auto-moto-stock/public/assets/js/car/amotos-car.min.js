!function(a){"use strict";a(document).ready((function(){if("undefined"!=typeof amotos_car_vars){var e={};e.isMobile=/(Android|BlackBerry|iPhone|iPad|Palm|Symbian|Opera Mini|IEMobile|webOS)/.test(navigator.userAgent),e.isAndroid=/(Android)/.test(navigator.userAgent),e.isiOS=/(iPhone|iPod|iPad)/.test(navigator.userAgent),e.isiPhone=/(iPhone|iPod)/.test(navigator.userAgent),e.isiPad=/(iPad|iPod)/.test(navigator.userAgent);var t,i,n=amotos_car_vars.ajax_url,r=amotos_car_vars.ajax_upload_url,s=amotos_car_vars.ajax_upload_attachment_url,o=".car-manage-form",l=(amotos_car_vars.amotos_metabox_prefix,amotos_car_vars.googlemap_zoom_level),c=amotos_car_vars.google_map_style,d=amotos_car_vars.googlemap_marker_icon,m=amotos_car_vars.googlemap_default_country,_=amotos_car_vars.googlemap_coordinate_default,p=(amotos_car_vars.upload_nonce,amotos_car_vars.localization.file_type_title),f=amotos_car_vars.max_car_images,u=amotos_car_vars.image_max_file_size,g=amotos_car_vars.max_car_attachments,v=amotos_car_vars.attachment_max_file_size,h=amotos_car_vars.attachment_file_type,y=null,b=null,x=a("#geocomplete");!function(){if(0!==x.length){a('input[name="car_form"]').val();var e=[];""!==c&&(e=JSON.parse(c)),x.geocomplete({map:".map_canvas",details:"form",country:m,geocodeAfterResult:!0,types:["geocode","establishment"],mapOptions:{zoom:parseInt(l),styles:e},markerOptions:{draggable:!0,icon:d},location:""!==x.val()?x.val():_}).one("geocode:result",(function(a,e){t=x.geocomplete("map"),google.maps.event.addListenerOnce(t,"idle",(function(){google.maps.event.trigger(t,"resize"),i=e.geometry.location,t.setCenter(e.geometry.location)}))})),x.bind("geocode:dragged",(function(e,t){a("input[name=lat]").val(t.lat()),a("input[name=lng]").val(t.lng()),a("#reset").show()})),x.on("focus",(function(){google.maps.event.trigger(t,"resize")})),a("#reset").on("click",(function(e){return e.preventDefault(),x.geocomplete("resetMarker"),a("#reset").hide(),!1})),a("#find").on("click",(function(e){e.preventDefault(),t=x.geocomplete("map");var n=x.geocomplete("marker");i=new google.maps.LatLng(a("#latitude").val(),a("#longitude").val()),t.setCenter(i),n.setPosition(i)})),a(window).on("load",(function(){x.trigger("geocode")}))}}(),a('input[name="manager_display_option"]',o).on("change",(function(){a('select[name="car_manager"]').hide(),"other_info"==a(this).val()?a("#car_other_contact").slideDown("slow"):a("#car_other_contact").slideUp("slow")}));var j=function(){a('input[name="car_price_on_call"]').is(":checked")?(a('input[name="car_price_short"]').attr("disabled","disabled"),a('select[name="car_price_unit"]').attr("disabled","disabled"),a('input[name="car_price_prefix"]').attr("disabled","disabled"),a('input[name="car_price_postfix"]').attr("disabled","disabled")):(a('input[name="car_price_short"]').removeAttr("disabled"),a('select[name="car_price_unit"]').removeAttr("disabled"),a('input[name="car_price_prefix"]').removeAttr("disabled"),a('input[name="car_price_postfix"]').removeAttr("disabled"))};j(),a('input[name="car_price_on_call"]',o).on("change",(function(){j()}));var w=function(){var e=0;a("tr","#amotos_additional_details").each((function(){var t=a('input[name*="additional_styling_title"]',a(this)),i=a('input[name*="additional_styling_value"]',a(this));t.attr("name","additional_styling_title["+e+"]"),t.attr("id","additional_styling_title_"+e),i.attr("name","additional_styling_value["+e+"]"),i.attr("id","additional_styling_value_"+e),e++}))};a("#amotos_additional_details").sortable({revert:100,placeholder:"detail-placeholder",handle:".sort-additional-row",cursor:"move",stop:function(a,e){w()}}),a(".add-additional-styling",o).on("click",(function(e){e.preventDefault();var t=a(this).data("increment")+1;a(this).data("increment",t),a(this).attr({"data-increment":t});var i='<tr><td class="action-field"><span class="sort-additional-row"><i class="fa fa-navicon"></i></span></td><td><input class="form-control" type="text" name="additional_styling_title['+t+']" id="additional_styling_title_'+t+'" value=""></td><td><input class="form-control" type="text" name="additional_styling_value['+t+']" id="additional_styling_value_'+t+'" value=""></td><td><span data-remove="'+t+'" class="remove-additional-styling"><i class="fa fa-remove"></i></span></td></tr>';a("#amotos_additional_details").append(i),k()}));var k=function(){a(".remove-additional-styling",o).on("click",(function(e){e.preventDefault();var t=a(this),i=t.closest(".additional-block").find(".add-additional-styling"),n=parseInt(i.data("increment"))-1;t.closest("tr").remove(),i.data("increment",n),i.attr("data-increment",n),w()}))};k();var P=function(){a(".icon-featured",".amotos-car-gallery").off("click").on("click",(function(){var e=a(this),t=e.data("attachment-id"),i=e.find("i");a(".media-thumb .featured-image-id").remove(),a(".media-thumb .icon-featured i").removeClass("fa-star").addClass("fa-star-o"),e.closest(".media-thumb").append('<input type="hidden" class="featured-image-id" name="featured_image_id" value="'+t+'">'),i.removeClass("fa-star-o").addClass("fa-star")})),a(".icon-delete",".amotos-car-gallery").off("click").on("click",(function(){var e=a(this),t=e.closest(".media-thumb-wrap").attr("id"),i=e.children("i"),r=e.closest(".media-thumb-wrap"),s=e.data("car-id"),o=e.data("attachment-id");void 0!==t&&!1!==t&&(t=t.replace("holder-","")),i.addClass("fa-spinner fa-spin"),a.ajax({type:"post",url:n,dataType:"json",data:{action:"amotos_remove_car_attachment_ajax",car_id:s,attachment_id:o,type:"gallery",removeNonce:e.data("nonce")},success:function(e){if(e.success){if(r.remove(),r.hide(),y&&void 0!==t&&!1!==t)for(var n=0;n<y.files.length;n++)if(y.files[n].id==t){y.removeFile(y.files[n]);break}if(0===a(".amotos-car-gallery").find('[name="featured_image_id"]').length){var s=a(".amotos-car-gallery").find(".media-thumb-wrap");if(s.length>0){var o=(s=a(s[0])).find(".car_image_ids").val();s.find(".icon-featured i").removeClass("fa-star-o").addClass("fa-star"),s.find(".media-thumb").append('<input type="hidden" class="featured-image-id" name="featured_image_id" value="'+o+'">')}}}i.removeClass("fa-spinner fa-spin")},error:function(){i.removeClass("fa-spinner fa-spin")}})}))};P();var C=function(){a(".icon-delete",".amotos-car-attachments").off("click").on("click",(function(){var e=a(this),t=e.closest(".media-thumb-wrap").attr("id"),i=e.children("i"),r=e.closest(".media-thumb-wrap"),s=e.data("car-id"),o=e.data("attachment-id");void 0!==t&&!1!==t&&(t=t.replace("holder-","")),i.addClass("fa-spinner fa-spin"),a.ajax({type:"post",url:n,dataType:"json",data:{action:"amotos_remove_car_attachment_ajax",car_id:s,attachment_id:o,type:"attachments",removeNonce:e.data("nonce")},success:function(a){if(a.success&&(r.remove(),r.hide(),b&&void 0!==t&&!1!==t))for(var e=0;e<b.files.length;e++)if(b.files[e].id==t){b.removeFile(b.files[e]);break}i.removeClass("fa-spinner fa-spin")},error:function(){i.removeClass("fa-spinner fa-spin")}})}))};C();var z=function(){a("#car_gallery_thumbs_container").sortable(),(y=new plupload.Uploader({browse_button:"amotos_select_gallery_images",file_data_name:"car_upload_file",container:"amotos_gallery_plupload_container",drop_element:"amotos_gallery_plupload_container",multi_selection:!0,url:r,filters:{mime_types:[{title:p,extensions:"jpg,jpeg,gif,png"}],max_file_size:u,prevent_duplicates:!0}})).init(),y.bind("FilesAdded",(function(e,t){var i="",n=f;if(a("#car_gallery_thumbs_container").find(".__thumb").length+e.files.length>n)return a.each(t,(function(a,t){e.removeFile(t)})),void alert(amotos_car_vars.localization.no_more_than+" "+n+" "+amotos_car_vars.localization.files);plupload.each(t,(function(a){i+='<div id="holder-'+a.id+'" class="col-sm-2 media-thumb-wrap"></div>'})),document.getElementById("car_gallery_thumbs_container").innerHTML+=i,e.refresh(),e.start()})),y.bind("UploadProgress",(function(a,e){document.getElementById("holder-"+e.id).innerHTML='<span><i class="fa fa-spinner fa-spin"></i></span>'})),y.bind("Error",(function(a,e){document.getElementById("amotos_gallery_errors_log").innerHTML+="<br/>Error #"+e.code+": "+e.message})),y.bind("FileUploaded",(function(e,t,i){var n=a.parseJSON(i.response);if(n.success){var r='<figure class="media-thumb"><img src="'+n.url+'"/><div class="media-item-actions"><a class="icon icon-delete" data-car-id="0" data-nonce="'+n.delete_nonce+'" data-attachment-id="'+n.attachment_id+'" href="javascript:;"><i class="fa fa-trash-o"></i></a><a class="icon icon-featured" data-car-id="0" data-attachment-id="'+n.attachment_id+'" href="javascript:;"><i class="fa fa-star-o"></i></a><input type="hidden" class="car_image_ids" name="car_image_ids[]" value="'+n.attachment_id+'"/><span style="display: none;" class="icon icon-loader"><i class="fa fa-spinner fa-spin"></i></span></div></figure>';document.getElementById("holder-"+t.id).innerHTML=r,0===a(".amotos-car-gallery").find('[name="featured_image_id"]').length&&(a("#holder-"+t.id).find(".icon-featured i").removeClass("fa-star-o").addClass("fa-star"),a("#holder-"+t.id).find(".media-thumb").append('<input type="hidden" class="featured-image-id" name="featured_image_id" value="'+n.attachment_id+'">')),P()}}))};z();var A=function(){a("#car_attachments_thumbs_container").sortable(),(b=new plupload.Uploader({browse_button:"amotos_select_file_attachments",file_data_name:"car_upload_file",container:"amotos_attachments_plupload_container",drop_element:"amotos_attachments_plupload_container",multi_selection:!0,url:s,filters:{mime_types:[{title:p,extensions:h}],max_file_size:v,prevent_duplicates:!0}})).init(),b.bind("FilesAdded",(function(e,t){var i="",n=g;if(a("#car_attachments_thumbs_container").find(".__thumb").length+e.files.length>n)return a.each(t,(function(a,t){e.removeFile(t)})),void alert(amotos_car_vars.localization.no_more_than+" "+n+" "+amotos_car_vars.localization.files);plupload.each(t,(function(a){i+='<div id="holder-'+a.id+'" class="col-lg-4 col-md-4 col-sm-6 col-xs-12 media-thumb-wrap"></div>'})),document.getElementById("car_attachments_thumbs_container").innerHTML+=i,e.refresh(),e.start()})),b.bind("UploadProgress",(function(a,e){document.getElementById("holder-"+e.id).innerHTML='<span><i class="fa fa-spinner fa-spin"></i></span>'})),b.bind("Error",(function(a,e){document.getElementById("amotos_attachments_errors_log").innerHTML+="<br/>Error #"+e.code+": "+e.message})),b.bind("FileUploaded",(function(e,t,i){var n=a.parseJSON(i.response);if(n.success){var r='<figure class="media-thumb"><img src="'+n.thumb_url+'"/><a href="'+n.url+'">'+n.file_name+'</a><div class="media-item-actions"><a class="icon icon-delete" data-nonce="'+n.delete_nonce+'" data-car-id="0"  data-attachment-id="'+n.attachment_id+'" href="javascript:;" ><i class="fa fa-trash-o"></i></a><input type="hidden" class="car_attachment_ids" name="car_attachment_ids[]" value="'+n.attachment_id+'"/><span style="display: none;" class="icon icon-loader"><i class="fa fa-spinner fa-spin"></i></span></div></figure>';document.getElementById("holder-"+t.id).innerHTML=r,C()}}))};A();var E=function(){var e=new plupload.Uploader({browse_button:"amotos_select_images_360",file_data_name:"car_upload_file",container:"amotos_image_360_plupload_container",url:r,filters:{mime_types:[{title:p,extensions:"jpg,jpeg,gif,png"}],max_file_size:u,prevent_duplicates:!0}});e.init(),e.bind("FilesAdded",(function(e,t){var i=f;if(e.files.length>i)return a.each(t,(function(a,t){e.removeFile(t)})),void alert(amotos_car_vars.localization.no_more_than+" "+i+" "+amotos_car_vars.localization.files);plupload.each(t,(function(a){})),e.refresh(),e.start()})),e.bind("Error",(function(a,e){document.getElementById("amotos_image_360_errors_log").innerHTML+="<br/>Error #"+e.code+": "+e.message})),e.bind("FileUploaded",(function(e,t,i){var n=a.parseJSON(i.response);if(n.success){a(".amotos_image_360_url").val(n.full_image),a(".amotos_image_360_id").val(n.attachment_id);var r='<iframe width="100%" height="200" scrolling="no" allowfullscreen src="'+a("#amotos_car_image_360_view").attr("data-plugin-url")+"public/assets/packages/vr-view/index.html?image="+n.full_image+'"></iframe>';a("#amotos_car_image_360_view").html(r)}}))};E();var O=function(){var e=a(".amotos-car-country-ajax",o);if(e.length){var t=e.val();if(a("#geocomplete").length>0)a("#geocomplete").geocomplete("autocomplete").setComponentRestrictions({country:t});a.ajax({type:"POST",url:n,data:{action:"amotos_get_states_by_country_ajax",country:t,type:0,is_slug:"1"},beforeSend:function(){e.parent().children(".amotos-loading").remove(),e.parent().append('<span class="amotos-loading"><i class="fa fa-spinner fa-spin"></i></span>')},success:function(t){a(".amotos-car-state-ajax",o).html(t);var i=a(".amotos-car-state-ajax",o).attr("data-selected");void 0!==i&&a(".amotos-car-state-ajax",o).val(i),e.parent().children(".amotos-loading").remove()},error:function(){e.parent().children(".amotos-loading").remove()},complete:function(){e.parent().children(".amotos-loading").remove()}})}};O(),a(".amotos-car-country-ajax",o).on("change",(function(){O()}));var S=function(){var e=a(".amotos-car-state-ajax",o);if(e.length){var t=e.val();a.ajax({type:"POST",url:n,data:{action:"amotos_get_cities_by_state_ajax",state:t,type:0,is_slug:"1"},beforeSend:function(){e.parent().children(".amotos-loading").remove(),e.parent().append('<span class="amotos-loading"><i class="fa fa-spinner fa-spin"></i></span>')},success:function(t){a(".amotos-car-city-ajax",o).html(t);var i=a(".amotos-car-city-ajax",o).attr("data-selected");void 0!==i&&a(".amotos-car-city-ajax",o).val(i),e.parent().children(".amotos-loading").remove()},error:function(){e.parent().children(".amotos-loading").remove()},complete:function(){e.parent().children(".amotos-loading").remove()}})}};S(),a(".amotos-car-state-ajax",o).on("change",(function(){S()}));var T=function(){var e=a(".amotos-car-city-ajax",o);if(e.length){var t=e.val();a.ajax({type:"POST",url:n,data:{action:"amotos_get_neighborhoods_by_city_ajax",city:t,type:0,is_slug:"1"},beforeSend:function(){e.parent().children(".amotos-loading").remove(),e.parent().append('<span class="amotos-loading"><i class="fa fa-spinner fa-spin"></i></span>')},success:function(t){a(".amotos-car-neighborhood-ajax",o).html(t);var i=a(".amotos-car-neighborhood-ajax",o).attr("data-selected");void 0!==i&&a(".amotos-car-neighborhood-ajax",o).val(i),e.parent().children(".amotos-loading").remove()},error:function(){e.parent().children(".amotos-loading").remove()},complete:function(){e.parent().children(".amotos-loading").remove()}})}};T(),a(".amotos-car-city-ajax",o).on("change",(function(){T()}));var M=a(".amotos-car-multi-step");M.find(".amotos-btn-next").on("click",(function(){e.isiOS&&(z(),A(),E()),"false"===a("#step-location").attr("aria-hidden")&&void 0!==x&&x.trigger("geocode")})),M.find(".amotos-btn-edit").on("click",(function(){e.isiOS&&(z(),A(),E()),"false"===a("#step-location").attr("aria-hidden")&&void 0!==x&&x.trigger("geocode")})),"1"==amotos_car_vars.enable_filter_location&&(a(".amotos-car-country-ajax",o).select2(),a(".amotos-car-state-ajax",o).select2(),a(".amotos-car-city-ajax",o).select2(),a(".amotos-car-neighborhood-ajax",o).select2()),a("#car_type, #car_status, #car_label",o).select2()}}))}(jQuery);
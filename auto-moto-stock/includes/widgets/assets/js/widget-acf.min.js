var AMOTOS_Widget_Acf=AMOTOS_Widget_Acf||{};!function(t){"use strict";AMOTOS_Widget_Acf={templates:[],init:function(){this.collapse(),this.changeTitle(),this.uploadImage(),this.addSection(),this.deleteSection(),this.initControls(),t(document).on("widget_acf_make_template_done",AMOTOS_Widget_Acf.initControls),t(document).on("widget-added",AMOTOS_Widget_Acf.makeTemplate),t(document).on("widget-updated",AMOTOS_Widget_Acf.makeTemplate)},makeTemplate:function(e,i){var a=i;void 0===i&&(a=t("#widgets-right .widget_acf_wrap"));var n=0;AMOTOS_Widget_Acf.templates=[],t(".accordion-wrap",a).each((function(){var e=t(".widget_acf_accordion",this).last();e.length&&(AMOTOS_Widget_Acf.templates[n]=e[0].outerHTML,t(this).attr("data-template",n),n++)})),t(document).trigger("widget_acf_make_template_done",[a])},sortable:function(e){t.isFunction(t.fn.sortable)&&t(".accordion-wrap",e).each((function(){var e=t(this);e.sortable({update:function(){AMOTOS_Widget_Acf.reIndexSection(e)}})}))},collapse:function(){t(document).on("click",".widget_acf_accordion h3.title",(function(){var e=t(this).parent(),i=t(".fieldset",e),a=i.attr("data-collapse");void 0===a||"1"==a?(i.slideDown(),i.attr("data-collapse","0"),t("span",t(this)).removeClass("collapse-in"),t("span",t(this)).addClass("collapse-out")):(i.slideUp(),i.attr("data-collapse","1"),t("span",t(this)).removeClass("collapse-out"),t("span",t(this)).addClass("collapse-in"))}))},changeTitle:function(){t(document).on("keyup",'.widget_acf_accordion input[data-title="1"]',(function(){var e=t(this).val(),i=t(this).attr("data-section-id");""==e&&(e="New Section"),t("span:last-child","#"+i+" h3.title").text(e)}))},addSection:function(){t(document).on("click",".widget_acf_wrap .button.add",(function(){var e=t(this).parent().prev(),i=e.data("template"),a=t(AMOTOS_Widget_Acf.templates[i]);e.append(a),AMOTOS_Widget_Acf.reIndexSection(e),AMOTOS_Widget_Acf.initControls(null,a)}))},deleteSection:function(){t(document).on("click",".widget_acf_accordion .button.deletion",(function(){var e=t(this).parent().parent().parent().parent(),i=t(".widget_acf_accordion",e).length,a=t(this).parent().parent().parent();i>1?(a.remove(),AMOTOS_Widget_Acf.reIndexSection(e)):(t("input",t(e)).each((function(){t(this).val("")})),t("h3.title span",t(e)).last().html("New Section")),t(e).find("input").trigger("change")}))},reIndexSection:function(e){var i="widget_acf_accordion_";t(".widget_acf_accordion",e).each((function(e){t(this).attr("id",i+e),t("input,textarea",t(this)).each((function(){void 0!==t(this).attr("name")&&t(this).attr("name",t(this).attr("name").replace(/\[(\d+)\](?!.*\[\d+\])/,"["+e+"]")),void 0!==t(this).attr("id")&&t(this).attr("id",t(this).attr("id").replace(/[0-9]$/,e)),t(this).attr("data-section-id",i+e),t(this).trigger("change")})),t("div[data-require-element-id]",t(this)).each((function(){t(this).attr("data-require-element-id",t(this).attr("data-require-element-id").replace(/[0-9]$/,e))})),t("select",t(this)).each((function(){void 0!==t(this).attr("name")&&t(this).attr("name",t(this).attr("name").replace(/\[(\d+)\](?!.*\[\d+\])/,"["+e+"]")),t(this).attr("id",t(this).attr("id").replace(/[0-9]$/,e))})),t("label",t(this)).each((function(){void 0!==t(this).attr("for")&&t(this).attr("for",t(this).attr("for").replace(/\[(\d+)\](?!.*\[\d+\])/,"["+e+"]"))})),t("a.button.deletion").each((function(){t(this).attr("data-section-id",i+e)}))}))},initSelectize:function(e){t("select.selectize",e).each((function(){var e=t(this).data("value");if(void 0===t(this).attr("multiple"))t(this).selectize();else{var i=t(this).selectize({plugins:["remove_button","drag_drop"]});void 0!==e&&i[0].selectize.setValue(e)}}))},initCheckbox:function(e){t(".checkbox",e).each((function(){var e=t(this);e.off(),e.change((function(){e.is(":checked")?e.val("1"):e.val("0")}))}))},registerRequireElement:function(e){t("input, select",e).each((function(){AMOTOS_Widget_Acf.initRequireElement(t(this)),t(this).on("change",(function(){AMOTOS_Widget_Acf.initRequireElement(t(this))}))}))},initRequireElement:function(e){var i=e.attr("id"),a=e.val();t('div[data-require-element-id="'+i+'"]').each((function(){var e=t(this).attr("data-require-compare"),i=t(this).attr("data-require-values");void 0!==i&&""!=i&&(i=i.split(","));var n=!1;"!="==e&&(n=!0),t.each(i,(function(t,i){i!=a||(n="="==e)})),n?t(this).show():t(this).hide()}))},uploadImage:function(){t(".widget-acf-upload-button").each((function(){t(this).off("click").on("click",(function(e){if(e.preventDefault(),wp.media.frames.gk_frame)return wp.media.frames.gk_frame.open(),void(wp.media.frames.gk_frame.clicked_button=t(this));wp.media.frames.gk_frame=wp.media({title:"Select image",multiple:!1,library:{type:"image"},button:{text:"Use selected image"}}),wp.media.frames.gk_frame.clicked_button=t(this);wp.media.frames.gk_frame.on("select",(function(){var e=wp.media.frames.gk_frame.state().get("selection");e&&e.each((function(e){var i=e.attributes.url,a=t(wp.media.frames.gk_frame.clicked_button).parent(),n=t("img",a),c=t("a.remove-media",a),r=t('input[data-type="id"]',a),d=t('input[data-type="url"]',a),o=wp.media.frames.gk_frame.clicked_button.attr("data-width"),s=wp.media.frames.gk_frame.clicked_button.attr("data-height");void 0===o&&(o=46),void 0===s&&(s=28),n.length<=0&&(n=t(n='<img src="" width="'+o+'" height="'+s+'">')),n.attr("src",i),d.val(i),r.val(e.attributes.id),d.trigger("change"),r.trigger("change"),a.prepend(n),c.length<=0&&(c=t('<a href="javascript:void(0);" class="button remove-media">Remove</a>')).insertAfter(wp.media.frames.gk_frame.clicked_button),AMOTOS_Widget_Acf.removeImage(a)}))})),wp.media.frames.gk_frame.open()})),AMOTOS_Widget_Acf.removeImage(t(this).parent())}))},removeImage:function(e){t(".remove-media",e).off("click").on("click",(function(){var i=t('input[data-type="id"]',e),a=t('input[data-type="url"]',e);t("img",e).remove(),a.val(""),i.val(""),a.trigger("change"),i.trigger("change"),t(this).remove()}))},initControls:function(e,i){var a=t("#widgets-right .widget_acf_wrap");void 0!==i&&(a=i),AMOTOS_Widget_Acf.sortable(a),AMOTOS_Widget_Acf.initCheckbox(a),AMOTOS_Widget_Acf.initSelectize(a),AMOTOS_Widget_Acf.registerRequireElement(a)}},t(document).ready((function(){AMOTOS_Widget_Acf.init()}))}(jQuery);
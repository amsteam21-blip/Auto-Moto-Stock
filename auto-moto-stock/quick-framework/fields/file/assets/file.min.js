var SQUICK_FileClass=function(i){this.$container=i};!function(i){"use strict";SQUICK_FileClass.prototype={init:function(){this.select(),this.remove(),this.sortable()},select:function(){var e=this,t=e.$container.find(".squick-file-add > button"),n=e.$container.find(".squick-field-file-inner"),a=n.data("lib-filter"),s={title:SQUICK_FILE_FIELD_META.title,button:SQUICK_FILE_FIELD_META.button},l=new SQUICK_Media;void 0!==a&&null!=a&&""!=a&&(s.filter=a),l.selectGallery(t,s,(function(t){if(t.length){var a=i(l.clickedButton),s=e.$container.find('input[type="hidden"]'),d=s.val(),f=d.split("|"),o="",c=n.data("remove-text");t.each((function(i){i=i.toJSON(),-1==f.indexOf(""+i.id)&&(""!=d?d+="|"+i.id:d=""+i.id,f.push(""+i.id),o+='<div class="squick-file-item" data-file-id="'+i.id+'">',o+='<span class="dashicons dashicons-media-document"></span>',o+='<div class="squick-file-info">',o+='<a class="squick-file-title" href="'+i.editLink+'" target="_blank">'+i.title+"</a>",o+='<div class="squick-file-name">'+i.filename+"</div>",o+='<div class="squick-file-action">',o+='<span class="squick-file-remove"><span class="dashicons dashicons-no-alt"></span> '+c+"</span>",o+="</div>",o+="</div>",o+="</div>")})),s.val(d);var r=i(o);a.parent().before(r),e.remove(r),e.changeField()}}))},remove:function(e){void 0===e&&(e=this.$container);var t=this;e.find(".squick-file-remove").on("click",(function(){var e=i(this).closest(".squick-file-item"),n=e.parent(),a=n.find('input[type="hidden"]');e.remove();var s="";i(".squick-file-item",n).each((function(){""!=s?s+="|"+i(this).data("file-id"):s=""+i(this).data("file-id")})),a.val(s),t.changeField()}))},sortable:function(){var e=this;this.$container.sortable({placeholder:"squick-file-sortable-placeholder",items:".squick-file-item",handle:".dashicons-media-document",update:function(t,n){var a=i(t.target),s="";i(".squick-file-item",a).each((function(){""!=s?s+="|"+i(this).data("file-id"):s=""+i(this).data("file-id")})),a.find('input[type="hidden"]').val(s),e.changeField()}})},changeField:function(){this.$container.find("[data-field-control]").trigger("squick_field_control_changed"),this.$container.find("[data-field-control]").trigger("change")},getValue:function(){var e=[];return this.$container.find("[data-field-control]").each((function(){e.push(i(this).val())})),e}}}(jQuery);
var SQUICK_MapClass=function(t){this.$container=t};!function(t){"use strict";SQUICK_MapClass.prototype={init:function(){this.$location=this.$container.find(".squick-map-location-field"),this.$address=this.$container.find(".squick-map-address input"),this.$findAddress=this.$container.find(".squick-map-address button"),this.$canvas=this.$container.find(".squick-map-canvas"),this.geocoder=new google.maps.Geocoder,this.bindMap(),this.mapListener(),this.findAddress(),this.autoComplete()},bindMap:function(){var e=this.$location.val(),n=this.$canvas.data("options");e=e?e.split(","):[-33.868419,151.193245];var o=new google.maps.LatLng(e[0],e[1]),a={center:o,zoom:16,scrollwheel:!1,streetViewControl:0,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM}};n&&(a=t.extend(a,n)),this.map=new google.maps.Map(this.$canvas[0],a),this.marker=new google.maps.Marker({position:o,map:this.map,draggable:!0})},mapListener:function(){var t=this;google.maps.event.addListener(t.map,"click",(function(e){t.marker.setPosition(e.latLng),t.$location.val(e.latLng.lat()+","+e.latLng.lng()),t.changeField()})),google.maps.event.addListener(t.marker,"drag",(function(e){t.$location.val(e.latLng.lat()+","+e.latLng.lng()),t.changeField()}))},findAddress:function(){var t=this;t.$findAddress.on("click",(function(){var e=t.$address.val();t.geocoder.geocode({address:e},(function(e,n){n===google.maps.GeocoderStatus.OK&&(t.map.setCenter(e[0].geometry.location),t.marker.setPosition(e[0].geometry.location),t.$location.val(e[0].geometry.location.lat()+","+e[0].geometry.location.lng()),t.changeField())}))})),t.$address.on("keydown",(function(e){13===e.which&&(e.preventDefault(),t.$findAddress.trigger("click"))}))},autoComplete:function(){var e=this;e.$address.autocomplete({source:function(n,o){e.geocoder.geocode({address:n.term},(function(e){o(t.map(e,(function(t){return{label:t.formatted_address,value:t.formatted_address,latitude:t.geometry.location.lat(),longitude:t.geometry.location.lng()}})))}))},select:function(t,n){var o=new google.maps.LatLng(n.item.latitude,n.item.longitude);e.map.setCenter(o),e.marker.setPosition(o),e.$location.val(n.item.latitude+","+n.item.longitude),e.changeField()}})},changeField:function(){this.$container.find(".squick-map-location-field").trigger("squick_field_control_changed")},getValue:function(){var e={};return this.$container.find("[data-field-control]").each((function(){var n=t(this),o=n.attr("name").replace(/^(.*)(\[)([^\]]*)(\])*$/g,(function(t,e,n,o,a){return o}));e[o]=n.val()})),e}}}(jQuery);
var SQUICK_THEME_OPTION;!function(e){"use strict";SQUICK_THEME_OPTION={_isSavingData:!1,init:function(){this.headerSize(),this.affixHeader(),this.backupListener(),this.checkFieldChange(),this.saveOptions(),this.resetOptions(),this.resetSection(),this.windowResize(),this.sectionClickedEvent(),this.presetProcess(),this.optionMessage(),this.deletePreset(),this.makeDefaultOptions()},optionMessage:function(){var t=e('<div class="squick-theme-options-message squick-warning">'+SQUICK_META_DATA.msgSaveWarning+"</div>"),i=e('<div class="squick-theme-options-message squick-success">'+SQUICK_META_DATA.msgSaveSuccess+"</div>");0==e(".squick-theme-options-preset").length?e(".squick-theme-options-action-inner").prepend(t).prepend(i):e(".squick-meta-box-fields").prepend(t).prepend(i)},headerSize:function(){var t=e(".squick-theme-options-action-wrapper");t.find(".squick-theme-options-action-inner").outerWidth(t.width())},affixHeader:function(){e(window).scroll((function(){var t=e(".squick-theme-options-action-wrapper");e(window).scrollTop()>t.offset().top-32?t.addClass("squick-affix"):t.removeClass("squick-affix")}))},windowResize:function(){e(window).resize((function(){SQUICK_THEME_OPTION.affixHeader(),SQUICK_THEME_OPTION.headerSize()}))},sectionClickedEvent:function(){e(document).on("squick_section_changed",(function(){SQUICK_THEME_OPTION.affixHeader(),SQUICK_THEME_OPTION.headerSize()}))},backupListener:function(){e(document).on("click",".squick-theme-options-import",(function(){var t=e("#_current_page").val(),i=e("#_current_preset").val(),s=e("#_wpnonce").val();STUtils.popup.show({src:SQUICK_META_DATA.ajaxUrl+"?action=squick_import_popup&_current_page="+t+"&_current_preset="+i+"&_wpnonce="+s,type:"ajax",callback:function(e){SQUICK_THEME_OPTION.importData(e),SQUICK_THEME_OPTION.exportData(e)}})}))},importData:function(t){t.find(".squick-theme-options-backup-import button").on("click",(function(){var t=e(this),i=t.parent().find("textarea").val();if(""!=i&&confirm(SQUICK_META_DATA.msgConfirmImportData)&&!t.data("importing")){var s=e("#_wpnonce").val(),n=e("#_current_page").val(),o=e("#_current_preset").val();t.data("importing",!0),t.html('<i class="fa fa-spin fa-spinner"></i> '+t.data("importing-text")),e.ajax({url:SQUICK_META_DATA.ajaxUrl,data:{_wpnonce:s,_current_page:n,_current_preset:o,action:"squick_import_theme_options",backup_data:i},type:"post",success:function(e){t.data("importing",!1),t.html(t.data("import-text")),1==e?(alert(SQUICK_META_DATA.msgImportDone),window.location.reload()):alert(SQUICK_META_DATA.msgImportError)}})}}))},exportData:function(t){t.find(".squick-theme-options-backup-export button").on("click",(function(){var t=e("#_wpnonce").val(),i=e("#_current_page").val(),s=e("#_current_preset").val();window.open(SQUICK_META_DATA.ajaxUrl+"?action=squick_export_theme_options&_wpnonce="+t+"&_current_page="+i+"&_current_preset="+s,"_blank")}))},checkFieldChange:function(){e(document).on("squick_field_change",".squick-field",(function(){var t=e(".squick-theme-options-message.squick-warning"),i=e(".squick-theme-options-message.squick-success");i.is(":visible")?i.slideUp((function(){t.is(":visible")||t.slideDown()})):t.is(":visible")||t.slideDown(),window.onbeforeunload=SQUICK_THEME_OPTION.confirmWhenPageExit}))},confirmWhenPageExit:function(e){e||(e=window.event),e.cancelBubble=!0,e.returnValue="",e.stopPropagation&&(e.stopPropagation(),e.preventDefault())},resetSection:function(){e(document).on("click",".squick-theme-options-reset-section",(function(){if(!SQUICK_THEME_OPTION._isSavingData&&confirm(SQUICK_META_DATA.msgConfirmResetSection)){e(this);var t=e("#_wpnonce").val(),i=e("#_current_page").val(),s=e("#_current_preset").val(),n=e(".squick-sections").find("li.active").data("id");SQUICK_THEME_OPTION.showLoading("reset_section"),e.ajax({url:SQUICK_META_DATA.ajaxUrl,data:{_wpnonce:t,_current_page:i,_current_preset:s,action:"squick_reset_section_options",section:n},type:"post",success:function(e){SQUICK_THEME_OPTION.hideLoading("reset_section"),1==e?(alert(SQUICK_META_DATA.msgResetSectionDone),window.location.reload()):alert(SQUICK_META_DATA.msgResetSectionError)}})}}))},resetOptions:function(){e(document).on("click",".squick-theme-options-reset-options",(function(){if(!SQUICK_THEME_OPTION._isSavingData&&confirm(SQUICK_META_DATA.msgConfirmResetOptions)){e(this);var t=e("#_wpnonce").val(),i=e("#_current_page").val(),s=e("#_current_preset").val();SQUICK_THEME_OPTION.showLoading("reset_option"),e.ajax({url:SQUICK_META_DATA.ajaxUrl,data:{_wpnonce:t,_current_page:i,_current_preset:s,action:"squick_reset_theme_options"},type:"post",success:function(e){SQUICK_THEME_OPTION.hideLoading("reset_option"),1==e?(alert(SQUICK_META_DATA.msgResetOptionsDone),window.location.reload()):alert(SQUICK_META_DATA.msgResetOptionsError)}})}}))},saveOptions:function(){e(window).bind("keydown",(function(t){if((t.ctrlKey||t.metaKey)&&"s"===String.fromCharCode(t.which).toLowerCase())return t.preventDefault(),e(".squick-theme-options-save-options",".squick-theme-options-page").trigger("click"),!1})),e(".squick-theme-options-form").ajaxForm({beforeSubmit:function(){if(SQUICK_THEME_OPTION._isSavingData)return!1;SQUICK_THEME_OPTION.showLoading("save")},success:function(t){if(window.onbeforeunload=null,SQUICK_THEME_OPTION.hideLoading("save"),t.success){var i=e(".squick-theme-options-message.squick-warning"),s=e(".squick-theme-options-message.squick-success");i.is(":visible")?i.slideUp((function(){s.slideDown()})):s.slideDown(),e(document).trigger("squick_save_option_success")}}})},deletePreset:function(){e(document).on("click",".squick-preset-action-delete",(function(){if(!SQUICK_THEME_OPTION._isSavingData&&confirm(SQUICK_META_DATA.msgConfirmDeletePreset)){e(this);var t=e("#_wpnonce").val(),i=e("#_current_page").val(),s=e("#_current_preset").val();SQUICK_THEME_OPTION.showLoading("delete_preset"),e.ajax({url:SQUICK_META_DATA.ajaxUrl,data:{_wpnonce:t,_current_page:i,_current_preset:s,action:"squick_delete_preset"},type:"post",success:function(t){SQUICK_THEME_OPTION.hideLoading("delete_preset"),1==t?e(".squick-theme-options-preset-select li").first().trigger("click"):alert(SQUICK_META_DATA.msgDeletePresetError)}})}}))},makeDefaultOptions:function(){e(document).on("click",".squick-preset-action-make-default",(function(){if(!SQUICK_THEME_OPTION._isSavingData&&confirm(SQUICK_META_DATA.msgConfirmMakeDefaultOptions)){e(this);var t=e("#_wpnonce").val(),i=e("#_current_page").val(),s=e("#_current_preset").val();SQUICK_THEME_OPTION.showLoading("make_default_options"),e.ajax({url:SQUICK_META_DATA.ajaxUrl,data:{_wpnonce:t,_current_page:i,_current_preset:s,action:"squick_make_default_options"},type:"post",success:function(t){SQUICK_THEME_OPTION.hideLoading("make_default_options"),1==t?e(".squick-theme-options-preset-select li").first().trigger("click"):alert(SQUICK_META_DATA.msgMakeDefaultOptionsError)}})}}))},showLoading:function(t){var i;switch(e(".squick-meta-box-wrap").addClass("in"),SQUICK_THEME_OPTION._isSavingData=!0,t){case"save":(i=e(".squick-theme-options-save-options")).data("button-text",i.html()),i.html('<i class="fa fa-spin fa-spinner"></i> '+SQUICK_META_DATA.msgSavingOptions);break;case"reset_option":(i=e(".squick-theme-options-reset-options")).data("button-text",i.html()),i.html('<i class="fa fa-spin fa-spinner"></i> '+SQUICK_META_DATA.msgResettingOptions);break;case"reset_section":(i=e(".squick-theme-options-reset-section")).data("button-text",i.html()),i.html('<i class="fa fa-spin fa-spinner"></i> '+SQUICK_META_DATA.msgResettingSection);break;case"delete_preset":(i=e(".squick-preset-action-delete")).data("button-text",i.html()),i.html('<i class="fa fa-spin fa-spinner"></i> '+SQUICK_META_DATA.msgDeletingPreset);break;case"make_default_options":(i=e(".squick-preset-action-make-default")).data("button-text",i.html()),i.html('<i class="fa fa-spin fa-spinner"></i> '+SQUICK_META_DATA.msgMakingDefaultOptions);break}},hideLoading:function(t){var i;switch(e(".squick-meta-box-wrap").removeClass("in"),SQUICK_THEME_OPTION._isSavingData=!1,t){case"save":(i=e(".squick-theme-options-save-options")).html(i.data("button-text"));break;case"reset_option":(i=e(".squick-theme-options-reset-options")).html(i.data("button-text"));break;case"reset_section":(i=e(".squick-theme-options-reset-section")).html(i.data("button-text"));break;case"delete_preset":(i=e(".squick-preset-action-delete")).html(i.data("button-text"));break;case"make_default_options":(i=e(".squick-preset-action-make-default")).html(i.data("button-text"));break}},presetProcess:function(){e(document).on("click",(function(t){0==e(t.target).closest(".squick-theme-options-preset-select").length&&e(".squick-theme-options-preset-select").removeClass("in")})),e(document).on("click",".squick-theme-options-preset-create",(function(){STUtils.popup.show({target:"#squick_options_preset_popup_wrapper",type:"target",callback:function(){var t=e(".squick-theme-options-preset-popup-content input");t.val(""),setTimeout((function(){t.focus()}),200)}})})),e(document).on("click",".squick-theme-options-preset-select",(function(){e(this).toggleClass("in")})),e(".squick-theme-options-preset-popup-content button").on("click",(function(){var t=e(".squick-theme-options-preset-popup-content input").val();if(""!=t){var i=e(this);if(i.hasClass("squick-preset-creating"))return;i.addClass("squick-preset-creating");var s=e("#_wpnonce").val(),n=e("#_current_page").val(),o=e("#_current_preset").val();e.ajax({url:SQUICK_META_DATA.ajaxUrl,data:{_wpnonce:s,_current_page:n,_current_preset:o,_preset_title:t,action:"squick_create_preset_options"},type:"post",success:function(t){i.removeClass("squick-preset-creating"),STUtils.popup.close();var s=e(t);e(".squick-theme-options-page").html(s),s.find(".squick-meta-box-wrap").each((function(){SQUICK.fields.initFields(e(this))})),SQUICK_THEME_OPTION.saveOptions(),SQUICK_THEME_OPTION.headerSize(),SQUICK_THEME_OPTION.optionMessage(),e(document).trigger("squick_section_changed"),e(".squick-field").trigger("squick_check_required"),e(".squick-field").trigger("squick_check_preset"),o=e("#_current_preset").val(),SQUICK_THEME_OPTION.changeLocation(o)},error:function(){i.removeClass("squick-preset-creating")}})}})),e(document).on("click",".squick-theme-options-preset-select li",(function(){if(!e(".squick-theme-options-message.squick-warning").is(":visible")||confirm(SQUICK_META_DATA.msgPreventChangeData)){var t=e(this);if(!t.hasClass("squick-preset-creating")){var i=e("#_current_preset").val(),s=t.data("preset");i!=s&&(t.addClass("squick-preset-creating"),e(".squick-theme-options-page").addClass("in"),SQUICK_THEME_OPTION.getPresetOptions(s,t))}}}))},getPresetOptions:function(t,i){var s=e("#_current_page").val();e.ajax({url:SQUICK_META_DATA.ajaxUrl,data:{_current_page:s,_current_preset:t,action:"squick_ajax_theme_options",_wpnonce:e("#_wpnonce").val()},type:"post",success:function(s){window.onbeforeunload=null,null!=i&&i.removeClass("squick-preset-creating"),e(".squick-theme-options-page").removeClass("in");var n=e(s);e(".squick-theme-options-page").html(n),n.find(".squick-meta-box-wrap").each((function(){SQUICK.fields.initFields(e(this))})),SQUICK_THEME_OPTION.headerSize(),SQUICK_THEME_OPTION.saveOptions(),SQUICK_THEME_OPTION.optionMessage(),e(document).trigger("squick_section_changed"),e(".squick-field").trigger("squick_check_required"),SQUICK_THEME_OPTION.changeLocation(t)},error:function(){null!=i&&i.removeClass("squick-preset-creating"),e(".squick-theme-options-page").removeClass("in")}})},changeLocation:function(e){var t=window.location.href;""==e?t=t.replace(/(&_squick_preset=)([^&]*)/g,(function(e,t,i){return""})):t.match(/(&_squick_preset=)([^&]*)/g)?t=t.replace(/(&_squick_preset=)([^&]*)/g,(function(t,i,s){return i+e})):t+="&_squick_preset="+e,window.history.pushState("","",t)}},e(document).ready((function(){SQUICK_THEME_OPTION.init()}))}(jQuery);
var SQUICK_ICON_POPUP=SQUICK_ICON_POPUP||{};!function(n){"use strict";SQUICK_ICON_POPUP={_$popup:[],_callback:function(){},_currentFontId:0,_fonts:[],_currentSection:"",_currentIcon:"",init:function(){SQUICK_ICON_POPUP._$popup=n("#squick-popup-icon-wrapper"),0===SQUICK_ICON_POPUP._$popup.length&&n.ajax({url:SQUICK_POPUP_DATA.ajaxUrl,type:"post",data:{action:"squick_get_font_icons",_wpnonce:SQUICK_POPUP_DATA.nonce},success:function(o){var i,t,p,c,_,u=JSON.parse(o),P=wp.template("squick-icons-popup");if(SQUICK_ICON_POPUP._fonts=u,0!=n("#tmpl-squick-icons-popup").length){for(i in u){0===SQUICK_ICON_POPUP._currentFontId&&(SQUICK_ICON_POPUP._currentFontId=i);var r={};for(u[i].groups=[],p=u[i].iconGroup.length,t=0;t<p;t++)for(_=u[i].iconGroup[t].icons.length,u[i].groups[u[i].iconGroup[t].id]=u[i].iconGroup[t].icons,c=0;c<_;c++)r[u[i].iconGroup[t].icons[c]]=!0;for(var e in u[i].groups[""]=[],r)u[i].groups[""].push(e)}var s=P(u);for(i in n("body").append(s),u)delete SQUICK_ICON_POPUP._fonts[i].iconGroup,delete SQUICK_ICON_POPUP._fonts[i].label,delete SQUICK_ICON_POPUP._fonts[i].total;SQUICK_ICON_POPUP._fonts=u,SQUICK_ICON_POPUP._$popup=n("#squick-popup-icon-wrapper"),SQUICK_ICON_POPUP.settingPopup(),SQUICK_ICON_POPUP.popupListener()}}}),SQUICK_ICON_POPUP.svg_icon(),n("body").on("squick_field_control_changed",(function(n){SQUICK_ICON_POPUP.svg_icon()}))},settingPopup:function(){var n=this._$popup.find(".squick-popup-icon-font-link-inner"),o=n.find(".squick-popup-icon-group-link"),i=this._$popup.find(".squick-popup-icon-group-section"),t=this._$popup.find(".squick-popup-icon-listing");n.each((function(n,o){o.__scrollBar=new PerfectScrollbar(o,{wheelSpeed:.5,suppressScrollX:!0})})),t.each((function(n,o){o.__scrollBar=new PerfectScrollbar(o,{wheelSpeed:.5,suppressScrollX:!0})})),o.css("display","none"),o.first().css("display","block"),i.css("display","none"),i.first().css("display","block")},popupListener:function(){var o=SQUICK_ICON_POPUP._$popup.find(".squick-popup-icon-search > input"),i=SQUICK_ICON_POPUP._$popup.find(".squick-popup-icon-group-link a"),t=SQUICK_ICON_POPUP._$popup.find(".squick-popup-icon-group-title"),p=SQUICK_ICON_POPUP._$popup.find(".squick-popup-icon-font > select");o.on("keyup",(function(){var o=n(this).val().toLowerCase();SQUICK_ICON_POPUP._currentSection="",""===o?t.text(t.data("msg-all")):t.text(t.data("msg-search").replace("{0}",o));var i=[];SQUICK_ICON_POPUP._fonts[SQUICK_ICON_POPUP._currentFontId]&&SQUICK_ICON_POPUP._fonts[SQUICK_ICON_POPUP._currentFontId].groups&&(i=SQUICK_ICON_POPUP._fonts[SQUICK_ICON_POPUP._currentFontId].groups[""].filter((function(n){return-1!==n.indexOf(o)}))),SQUICK_ICON_POPUP.bindListFont(i,!1),SQUICK_ICON_POPUP.updateListingScroll()})),i.on("click",(function(){var i=n(this),p=i.data("id");SQUICK_ICON_POPUP._currentSection=p,t.text(i.text()),o.val("");var c=[];SQUICK_ICON_POPUP._fonts[SQUICK_ICON_POPUP._currentFontId]&&SQUICK_ICON_POPUP._fonts[SQUICK_ICON_POPUP._currentFontId].groups&&(c=SQUICK_ICON_POPUP._fonts[SQUICK_ICON_POPUP._currentFontId].groups[p]),SQUICK_ICON_POPUP.bindListFont(c,!1),SQUICK_ICON_POPUP.updateListingScroll()})),p.on("change",(function(){var o=SQUICK_ICON_POPUP._$popup.find(".squick-popup-icon-font-link-inner").find(".squick-popup-icon-group-link"),i=SQUICK_ICON_POPUP._$popup.find(".squick-popup-icon-group-section"),t=SQUICK_ICON_POPUP._$popup.find(".squick-popup-icon-search > input");SQUICK_ICON_POPUP._currentFontId=n(this).val(),SQUICK_ICON_POPUP._currentSection="",o.fadeOut(),i.fadeOut(),o.each((function(){var o=n(this);o.data("font-id")===SQUICK_ICON_POPUP._currentFontId&&o.fadeIn((function(){SQUICK_ICON_POPUP.updateLinkScroll()}))})),i.each((function(){var o=n(this);o.data("font-id")===SQUICK_ICON_POPUP._currentFontId&&o.fadeIn((function(){SQUICK_ICON_POPUP.updateListingScroll()}))})),t.val(""),t.trigger("keyup")})),this.iconLoadMore()},iconLoadMore:function(){SQUICK_ICON_POPUP._$popup.find(".squick-popup-icon-group-load-more");n(document).on("click",".stu-popup-wrap .squick-popup-icon-group-load-more button",(function(o){o.preventDefault();var i=n(this).closest(".squick-popup-icon-group-section"),t=SQUICK_ICON_POPUP._$popup.find(".squick-popup-icon-search > input").val(),p=i.find(" > ul > li").length;if(""!==t){var c=SQUICK_ICON_POPUP._fonts[SQUICK_ICON_POPUP._currentFontId].groups[""].filter((function(n,o){return o>=p&&-1!==n.indexOf(t)}));SQUICK_ICON_POPUP.bindListFont(c,!0)}else c=SQUICK_ICON_POPUP._fonts[SQUICK_ICON_POPUP._currentFontId].groups[SQUICK_ICON_POPUP._currentSection].filter((function(n,o){return o>=p})),SQUICK_ICON_POPUP.bindListFont(c,!0)}))},iconClickEvent:function(){n(document).on("click",".squick-popup-icon-group-section i",(function(o){o.preventDefault(),n(this).closest(".stu-popup-wrap").trigger("stu-popup-close"),SQUICK_ICON_POPUP._callback(n(this).attr("class"))}))},updateLinkScroll:function(){n(".squick-popup-icon-font-link-inner").each((function(n,o){o.__scrollBar&&o.__scrollBar.update()}))},updateListingScroll:function(){n(".squick-popup-icon-listing").each((function(n,o){o.__scrollBar&&o.__scrollBar.update()}))},open:function(n,o){var i=SQUICK_ICON_POPUP._$popup.find(".squick-popup-icon-search > input");SQUICK_ICON_POPUP._currentIcon=n,i.val(""),i.trigger("keyup"),"function"==typeof o&&(SQUICK_ICON_POPUP._callback=o),STUtils.popup.show({target:"#squick-popup-icon-target",type:"target",callback:function(){SQUICK_ICON_POPUP.updateLinkScroll(),SQUICK_ICON_POPUP.updateListingScroll()}})},close:function(){},bindListFont:function(o,i){var t=this._$popup.find('.squick-popup-icon-group-section[data-font-id="'+this._currentFontId+'"]'),p=t.find(" > .squick-popup-icon-group-load-more > button"),c="",_=0;for(var u in o){if(++_>160)break;o[u]===this._currentIcon?c+='<li title="'+o[u]+'" class="active"><i class="'+o[u]+'"></i></li>':c+='<li title="'+o[u]+'"><i class="'+o[u]+'"></i></li>'}var P=n(c);SQUICK_ICON_POPUP.svg_icon(P),i?t.find(" > ul").append(P):t.find(" > ul").html(P),this.iconClickEvent(),_>160?p.show():p.hide()},svg_icon:function(o){void 0===o&&(o=n("body")),o.find(".svg-icon").each((function(){var o=n(this),i=o.attr("class"),t=i.replace("svg-icon svg-icon-",""),p='<svg class="'+i+'" aria-hidden="true" role="img"> <use href="#'+t+'" xlink:href="#'+t+'"></use> </svg>';o.html(p)}))}},n(document).ready((function(){SQUICK_ICON_POPUP.init()}))}(jQuery);